{% extends "mail/email_base.xhtml" %}

{% load utils_tags %}

{% block header_color %}{{ header_color }}{% endblock %}

{% block body %}
    <h2 style="color: #282F33; font-size: 20px; font-weight: bold; text-align: center; margin: 20px 0 4px;">
        {{ transition_label }}
    </h2>
    <p style="text-align: center; color: #888; font-size: 14px; margin: 0 0 24px;">
        {{ user.username }} upgraded to {{ tier_display }}
    </p>

    <hr style="border: none; border-top: 2px solid {{ header_color }}; margin: 0 0 20px;">
    <h3 style="font-size: 11px; color: #999; text-transform: uppercase; letter-spacing: 1.5px; margin: 0 0 12px;">
        Account
    </h3>
    <table cellpadding="0" cellspacing="0" border="0" style="width: 100%; font-family: 'Helvetica Neue', Arial, sans-serif; font-size: 14px; line-height: 26px;">
        <tr>
            <td style="color: #999; padding: 2px 0; width: 130px;">Username</td>
            <td style="font-weight: bold;">{{ user.username }}</td>
        </tr>
        <tr>
            <td style="color: #999; padding: 2px 0;">Email</td>
            <td><a href="mailto:{{ email }}" style="color: #1251ba; text-decoration: none;">{{ email }}</a></td>
        </tr>
        <tr>
            <td style="color: #999; padding: 2px 0;">Member for</td>
            <td>{{ account_age }} <span style="color: #bbb;">(since {{ date_joined|date:"M j, Y" }})</span></td>
        </tr>
        <tr>
            <td style="color: #999; padding: 2px 0;">Last seen</td>
            <td>{{ last_seen|date:"M j, Y" }}</td>
        </tr>
        <tr>
            <td style="color: #999; padding: 2px 0;">Upgrade path</td>
            <td style="font-weight: bold; color: {{ header_color }};">{{ transition_label }}</td>
        </tr>
    </table>

    <hr style="border: none; border-top: 1px solid #eee; margin: 20px 0;">
    <h3 style="font-size: 11px; color: #999; text-transform: uppercase; letter-spacing: 1.5px; margin: 0 0 12px;">
        Usage
    </h3>
    <table cellpadding="0" cellspacing="0" border="0" style="width: 100%; font-family: 'Helvetica Neue', Arial, sans-serif; font-size: 14px; line-height: 26px;">
        <tr>
            <td style="color: #999; padding: 2px 0; width: 130px;">Feeds</td>
            <td><strong>{{ feed_count|commify }}</strong> total, {{ active_feed_count|commify }} active</td>
        </tr>
        <tr>
            <td style="color: #999; padding: 2px 0;">Stories read</td>
            <td><strong>{{ stories_read|commify }}</strong></td>
        </tr>
        <tr>
            <td style="color: #999; padding: 2px 0;">Feed opens</td>
            <td>{{ feed_opens|commify }}</td>
        </tr>
        <tr>
            <td style="color: #999; padding: 2px 0;">Saved stories</td>
            <td>{{ starred_count|commify }}</td>
        </tr>
        <tr>
            <td style="color: #999; padding: 2px 0;">Shared stories</td>
            <td>{{ shared_count|commify }}</td>
        </tr>
        <tr>
            <td style="color: #999; padding: 2px 0;">Following</td>
            <td>{{ following_count }}</td>
        </tr>
        <tr>
            <td style="color: #999; padding: 2px 0;">Followers</td>
            <td>{{ follower_count }}</td>
        </tr>
    </table>

    <hr style="border: none; border-top: 1px solid #eee; margin: 20px 0;">
    <h3 style="font-size: 11px; color: #999; text-transform: uppercase; letter-spacing: 1.5px; margin: 0 0 12px;">
        Payment History
    </h3>
    <table cellpadding="0" cellspacing="0" border="0" style="width: 100%; font-family: 'Helvetica Neue', Arial, sans-serif; font-size: 14px; line-height: 26px;">
        <tr>
            <td style="color: #999; padding: 2px 0; width: 130px;">Total paid</td>
            <td style="font-weight: bold;">${{ total_paid }}</td>
        </tr>
        <tr>
            <td style="color: #999; padding: 2px 0;">Payments</td>
            <td>{{ payment_count }} payment{{ payment_count|pluralize }}</td>
        </tr>
        {% if first_payment_date %}
        <tr>
            <td style="color: #999; padding: 2px 0;">First payment</td>
            <td>{{ first_payment_date|date:"M j, Y" }}</td>
        </tr>
        {% endif %}
        <tr>
            <td style="color: #999; padding: 2px 0;">Stripe</td>
            <td style="font-family: monospace; font-size: 13px;">{{ stripe_id|default:"--" }}</td>
        </tr>
        <tr>
            <td style="color: #999; padding: 2px 0;">PayPal</td>
            <td style="font-family: monospace; font-size: 13px;">{{ paypal_sub_id|default:"--" }}</td>
        </tr>
        <tr>
            <td style="color: #999; padding: 2px 0;">Auto-renewal</td>
            <td>{% if premium_renewal %}Yes{% else %}No{% endif %}</td>
        </tr>
        {% if premium_expire %}
        <tr>
            <td style="color: #999; padding: 2px 0;">Expires</td>
            <td>{{ premium_expire|date:"M j, Y" }}</td>
        </tr>
        {% endif %}
    </table>

    {% if latest_payments %}
    <table cellpadding="0" cellspacing="0" border="0" style="width: 100%; font-family: 'Helvetica Neue', Arial, sans-serif; font-size: 13px; line-height: 22px; margin-top: 16px; border-collapse: collapse;">
        <tr style="border-bottom: 2px solid #eee;">
            <td style="color: #999; padding: 6px 8px 6px 0; font-weight: bold;">Date</td>
            <td style="color: #999; padding: 6px 8px; font-weight: bold;">Amount</td>
            <td style="color: #999; padding: 6px 8px; font-weight: bold;">Provider</td>
            <td style="color: #999; padding: 6px 0 6px 8px; font-weight: bold;">Status</td>
        </tr>
        {% for payment in latest_payments %}
        <tr style="border-bottom: 1px solid #f5f5f5;">
            <td style="padding: 5px 8px 5px 0;">{{ payment.payment_date|date:"M j, Y" }}</td>
            <td style="padding: 5px 8px;">${{ payment.payment_amount }}</td>
            <td style="padding: 5px 8px;">{{ payment.payment_provider }}</td>
            <td style="padding: 5px 0 5px 8px;">{% if payment.refunded %}<span style="color: #c0392b; font-weight: bold;">Refunded</span>{% else %}Paid{% endif %}</td>
        </tr>
        {% endfor %}
    </table>
    {% endif %}
{% endblock %}

{% block footer %}{% endblock %}
{% block optout %}{% endblock %}
