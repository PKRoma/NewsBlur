{% load utils_tags %}
<!DOCTYPE html>
<html>
<head>
  <title>{% block title %}NewsBlur{% endblock %}</title>
  {% include_stylesheets "common" %}
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <style>
    @media (prefers-color-scheme: dark) {
      html, body { background-color: #191b1c; color: #c0c0c0; }
    }
  </style>

  <script>
    window.NEWSBLUR = {};
    NEWSBLUR.Models = {};
    NEWSBLUR.Collections = {};
    NEWSBLUR.Globals = {
      'is_authenticated'        : {{ user.is_authenticated|yesno:"true,false" }},
      'is_anonymous'            : {{ user.is_anonymous|yesno:"true,false" }},
      'is_premium'              : {{ user.profile.is_premium|yesno:"true,false" }},
      'MEDIA_URL'               : "{{ MEDIA_URL }}"
    };
    NEWSBLUR.URLs = {
      'favicon'                 : "/rss_feeds/icon/{id}"
    };
    NEWSBLUR.stats = {{ stats|safe }};
  </script>

  {% include_javascripts "statistics" %}
  
</head>

<body class="NB-embedded-statistics {% if user.profile.is_premium %}NB-premium{% endif %}">

  <div class="NB-embedded-stats"></div>

  <script>
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      document.body.classList.add('NB-dark');
    }
  </script>
  <script>
    NEWSBLUR.stats_feed = new NEWSBLUR.Models.Feed({{ feed_js|safe }});
    NEWSBLUR.stats_dialog = new NEWSBLUR.ReaderStatistics({{ feed.pk }}, {embedded: true});
    NEWSBLUR.stats_dialog.populate_stats(null, NEWSBLUR.stats);
  </script>
  
</body>
</html>